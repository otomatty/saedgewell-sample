name: Template Sync

on:
  schedule:
    - cron: '0 0 */2 * *'  # 1æ—¥ãŠãã®åˆå‰0æ™‚ã«å®Ÿè¡Œ
  workflow_dispatch:      # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  template-sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Git
        run: |
          git config user.name 'github-actions[bot]'
          git config user.email 'github-actions[bot]@users.noreply.github.com'

      - name: Add upstream remote
        run: |
          git remote add upstream https://github.com/otomatty/super-next-app.git
          git fetch upstream

      - name: Create sync branch
        run: |
          git checkout -b template-sync-$(date +%Y%m%d)
          
      - name: Run update script for specific directories
        run: |
          chmod +x ./scripts/update-from-template.sh
          # packages ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ›´æ–°ï¼ˆãƒ«ãƒ¼ãƒˆã®package.jsonã¯é™¤å¤–ï¼‰
          git checkout upstream/main -- packages/
          # ã‚‚ã—ãƒ«ãƒ¼ãƒˆã®package.jsonãŒæ›´æ–°ã•ã‚ŒãŸå ´åˆã¯å…ƒã«æˆ»ã™
          git checkout HEAD -- package.json
          # tooling ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ›´æ–°
          git checkout upstream/main -- tooling/
          # ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°ï¼ˆpackage.jsonã‚’é™¤ãï¼‰
          git checkout upstream/main -- *.toml
          git checkout upstream/main -- *.yml
          git checkout upstream/main -- .gitattributes
          git checkout upstream/main -- .npmrc
          git checkout upstream/main -- .nvmrc
          # ç‰¹å®šã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿æ›´æ–°ï¼ˆpackage.jsonä»¥å¤–ï¼‰
          git checkout upstream/main -- tsconfig.json
          git checkout upstream/main -- biome.json

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          title: 'ğŸ”„ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ›´æ–°ã‚’åŒæœŸï¼ˆé™¤å¤–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚ã‚Šï¼‰'
          body: |
            è¦ªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ã®æ›´æ–°ã‚’åŒæœŸã—ã¾ã™ã€‚
            
            æ›´æ–°å¯¾è±¡ï¼š
            - packages/
            - tooling/
            - ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆpackage.jsoné™¤ãï¼‰
            
            é™¤å¤–å¯¾è±¡ï¼š
            - apps/
            - docs/
            - .cursor/
            - package.json
            
            - ã“ã® PR ã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™
            - ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆãŒã‚ã‚‹å ´åˆã¯æ‰‹å‹•ã§ã®è§£æ±ºãŒå¿…è¦ã§ã™
            - ãƒãƒ¼ã‚¸å‰ã«ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã‚’ç¢ºèªã—ã¦ãã ã•ã„
          branch: template-sync-$(date +%Y%m%d)
          base: main
          labels: |
            template-sync
            automated pr
          commit-message: 'ğŸ”„ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ›´æ–°ã‚’åŒæœŸï¼ˆé™¤å¤–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚ã‚Šï¼‰' 