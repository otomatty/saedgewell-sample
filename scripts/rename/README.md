# コンポーネントファイル名変換スクリプト

このスクリプトは、Reactコンポーネントのファイル名をキャメルケース（`MyComponent`）とケバブケース（`my-component`）の間で変換するためのツールです。インポートパスの自動更新も行います。

## 前提条件

- Go 1.16以上がインストールされていること
  ```bash
  go version  # バージョン確認
  ```
  
  インストールされていない場合は以下のコマンドでインストール:
  ```bash
  # macOS (Homebrew)
  brew install go
  
  # Linux (Debian/Ubuntu)
  sudo apt-get install golang-go
  ```

## ビルド手順

1. スクリプトのディレクトリに移動
   ```bash
   cd scripts/rename
   ```

2. 依存パッケージの解決とビルド
   ```bash
   go mod tidy
   go build
   ```
   
   これにより `rename-script` という実行ファイルが生成されます。

## 使用方法

スクリプトは対話式で動作し、プロジェクト構造の分析からファイル名の変換までガイドします。

1. スクリプトの実行
   ```bash
   # scripts/rename ディレクトリから実行
   ./rename-script
   ```
   または
   ```bash
   # プロジェクトルートから実行
   ./scripts/rename/rename-script
   ```
   
   コマンドラインオプション:
   ```bash
   # テストモードの実行（単体テストを実行）
   ./rename-script --test
   
   # 強制適用モード（対話型でドライランを選択しても変換を適用可能）
   ./rename-script --apply
   ```

2. インタラクティブなプロンプトに従って選択

   a. **検索対象の選択方法**
      - `apps/packagesの全ディレクトリを変換する`: 全てのディレクトリを対象に
      - `apps/packagesからディレクトリを選択する`: 特定のディレクトリのみを対象に
      - `キャンセル`: 処理を中止

   b. **ディレクトリの個別選択** (選択式を選んだ場合)
      - 各ディレクトリの横に `[キャメル: X, ケバブ: Y, 合計: Z]` の形式で統計情報が表示されます
      - スペースキーで複数のディレクトリを選択可能
      - エンターキーで選択完了
      - `選択完了` を選択すると次のステップへ
      - `前のステップに戻る` で選択方法に戻る
      - `キャンセル` で処理を中止

   c. **変換方向の選択**
      - `キャメルケース → ケバブケース`: 例 `Button.tsx` → `button.tsx`
      - `ケバブケース → キャメルケース`: 例 `user-card.tsx` → `UserCard.tsx`
      - `前のステップに戻る` でディレクトリ選択に戻る
      - `キャンセル`: 処理を中止

   d. **実行モードの選択**
      - `テストする（ドライラン・変更なし）`: 実際にファイルを変更せずに変換内容を確認
      - `変換する（実際に変更を適用）`: 実際にファイルを変更
      - `変換方向を変更する`: 変換方向選択に戻る
      - `ディレクトリ選択に戻る`: ディレクトリ選択に戻る
      - `キャンセル`: 処理を中止

   e. **テスト実行の確認** (「変換する」を選んだ場合)
      - `はい、テスト済みです`: 変換を実行
      - `いいえ、テストに戻ります`: テストモードで実行
      - `キャンセル`: 処理を中止

   f. **最終確認**
      - 変換対象のディレクトリと変換方向、実行モードが表示され、確認を求められます
      - テストモード: `テスト実行する` でテスト実行
      - 変換モード: `変換を実行する` で変換実行
      - `設定をやり直す`: 最初から設定をやり直す
      - `キャンセル`: 処理を中止

3. 変換結果の出力
   - 変換されたファイル一覧
   - 更新されたインポートパスの一覧（ドライランでも確認可能）
   - 処理の概要（合計ファイル数、処理ファイル数、スキップファイル数、エラーファイル数、パーセンテージ）
   - インポートパス更新対象ファイル数とリスト（ドライランの場合）

## 新機能

### ドライランモード
- `テストする`オプションで実際のファイル変更なしに変換内容を確認
- インポートパス更新の対象となるファイルも確認可能
- 処理結果の詳細な統計を表示

### 階層的ナビゲーション
- 「前のステップに戻る」オプションで前の選択肢に戻れる
- 各ステップで「キャンセル」オプションが利用可能
- 設定をやり直すオプションが最終確認で提供される

### インポートパス更新の強化
- ドライランモードでもインポートパス更新対象ファイルを表示
- 各ディレクトリごとのインポートパス更新対象ファイルリスト表示
- 全ディレクトリでの合計と集約されたリスト表示

### 詳細な統計情報
- 合計ファイル数、処理ファイル数、スキップファイル数、エラーファイル数を表示
- パーセンテージによる進捗状況の視覚化
- インポートパス更新対象ファイル数の表示
- 各ディレクトリとファイル種別の統計情報

### 複数ディレクトリの選択
- スペースキーを使って複数のディレクトリを選択可能
- 選択したディレクトリの数が表示されます
- 各ディレクトリの横にファイル統計情報が表示されるので判断が容易

### キャンセル機能
- 以下の方法で処理をいつでも中止できます:
  - 各選択メニューでの「キャンセル」オプション
  - 最終確認での「キャンセル」オプション
  - 任意のタイミングでの `Ctrl+C` キー

## 検索対象ディレクトリ

スクリプトは次のディレクトリを自動的に検出します:

- `apps` ディレクトリ内のコンポーネントディレクトリ
- `packages` ディレクトリ内のコンポーネントディレクトリ
- `.tsx` または `.jsx` ファイルを含むディレクトリが優先的に検出されます

## 除外ファイル

以下のファイルは自動的に除外されます:
- Next.jsの特殊ファイル (`page.tsx`, `layout.tsx`, `loading.tsx` など)
- 除外対象のディレクトリ内のファイル (`node_modules`, `dist`, `.git` など)

## 注意事項

1. **バックアップ**
   - 実行前に必ずGitリポジトリをコミットするか、ファイルをバックアップしてください。

2. **実行位置**
   - スクリプトはプロジェクトルートを自動検出しますが、`scripts/rename` ディレクトリから実行することを推奨します。
   - プロジェクトルートは `apps` または `packages` ディレクトリが存在するディレクトリとして自動検出されます。

3. **テスト実行の推奨**
   - 大規模な変更を行う前に、「テストする」オプションでドライラン実行することを強く推奨します。
   - 実際に変換を行う前に、インポートパスの更新対象ファイルを確認してください。

## トラブルシューティング

1. **ディレクトリが検出されない場合**
   - プロジェクトルートに `apps` または `packages` ディレクトリが存在することを確認してください。
   - ディレクトリ内に `.tsx` または `.jsx` ファイルが存在することを確認してください。

2. **ビルドエラーが発生する場合**
   ```bash
   go mod tidy  # 依存関係を再解決
   go build     # 再ビルド
   ```

3. **実行時エラーが発生する場合**
   - `scripts/rename` ディレクトリから実行してみてください。
   - 必要な権限があることを確認してください。

## 開発者向け情報

### コードの構成
スクリプトのコードは以下のように分割されています:

- `types.go`: 基本的な型定義
- `utils.go`: ユーティリティ関数（文字列変換など）
- `analyzer.go`: プロジェクト構造分析機能
- `converter.go`: ファイル変換とインポートパス更新機能
- `main.go`: メインロジックとインタラクティブUI

### テスト実行方法
スクリプトにはユニットテストが含まれています:

```bash
# すべてのテストを実行
go test ./...

# 特定のテストを実行
go test -run TestIsCamelCase ./...

# テストカバレッジの表示
go test -cover ./...
```

### 主な機能

1. **プロジェクト構造分析**
   - `apps/packages` ディレクトリの自動検出
   - TSX/JSXファイルを含むディレクトリの特定
   - ファイル命名規則の統計収集

2. **ファイル変換**
   - インタラクティブな設定
   - 複数ディレクトリの一括変換
   - インポートパスの自動更新

3. **ユーザビリティ機能**
   - 直感的なインタラクティブUI
   - 処理のキャンセル機能
   - 詳細な変換統計レポート
   - ドライランによる変換内容確認
   - 階層的なナビゲーション 

## 除外設定

ファイル名の変換対象から特定のパターンを除外するために、`excludes.yaml`という設定ファイルを使用できます。
このファイルは、`scripts/rename`ディレクトリ内に配置されています。

設定ファイルには、以下の項目があります：

- `exclude_files`: 変換対象から除外するファイル名パターン（例：`page.tsx`, `layout.tsx`など）
- `exclude_imports`: 特定のインポートパスを持つファイルを除外するためのパターン（例：`@kit/ui`, `*/actions/`など）
- `exclude_directories`: スキャン対象から除外するディレクトリ（例：`node_modules`, `dist`など）

### 除外設定の例

```yaml
# 除外設定ファイル
# このファイルでは、変換対象から除外するパターンを定義します

# ファイル名の除外パターン（Next.jsの特殊ファイルなど）
exclude_files:
  - page.tsx
  - layout.tsx
  - loading.tsx

# インポートパスの除外パターン
exclude_imports:
  # 共通パッケージからのインポート
  - "@kit/ui"
  # actionsディレクトリからのインポート（関数のため）
  - "*/actions/"

# 除外ディレクトリ
exclude_directories:
  - "node_modules"
  - "dist"
```

この設定により、例えば以下のようなファイルが変換対象から除外されます：

1. 名前が `page.tsx` や `layout.tsx` のファイル
2. `@kit/ui` からコンポーネントをインポートしているファイル
3. `actions` ディレクトリからインポートしているファイル

これにより、UIライブラリからインポートされたコンポーネントや、関数として使用されるアクションなど、特定のパターンのファイルを変換対象から除外できます。 