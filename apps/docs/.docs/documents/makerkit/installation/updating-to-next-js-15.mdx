---
title: 'Next.js 15へのアップデート'
description: 'MakerkitをNext.js 15にアップデートするためのガイド。コードベースを最新のNext.jsバージョンに移行するために知っておくべきすべてのこと。'
icon: 'refresh'
order: 11
---

# MakerkitをNext.js 15にアップデートするためのガイドライン

MakerkitはもともとNext.js 14の上に構築されていました。しかし、Next.js 15がリリースされたため、ボイラープレートを最新バージョンに合わせて更新しました。

これは、コードベースにいくつかの変更を適用したり、ボイラープレートの最新バージョンからマージしたりする必要があることを意味します。

幸いなことに、APIには大きな破壊的変更はないため、移行は比較的簡単なはずです。ただし、手動で行う必要がある変更がいくつかあります。

このドキュメントでは、Makerkitで必要なことだけをガイドします。より包括的なガイドについては、Next.jsのドキュメントとMakerkit独自のNext.js 15へのアップデートガイドを参照してください。

## Next.js 15での変更点

以下は変更点の概要です：

- **Next.jsバージョンの更新**: 様々なパッケージでNext.jsバージョンを更新
- **Next.js設定の更新**: Next.js設定を変更した場合は、最新バージョンに合わせて更新する必要があります
- **動的パラメータがPromiseベースになりました**: おそらく最も重要な変更は、動的パラメータの導入です。これは、クッキー、ヘッダー、クエリパラメータ、セグメントにアクセスする際に、同期関数の代わりにプロミスを使用するようにコードを更新する必要があることを意味します。

キットには、リンティングとフォーマットに関するその他の一般的な改善も追加されているため、マージの競合が発生する可能性があります。ただし、これらはそれほど重要ではなく、自分の変更を受け入れることで手動で解決できます。

移行には、コードベースによって5分から1時間かかる場合があります。私が行った変更と調査に比べればまだまだ少ないですよ！😅

## Makerkitを最新バージョンに更新する

Makerkitを最新バージョンに更新するには、次のコマンドを実行します：

```bash
git pull upstream main
```

これにより、プロジェクト内のすべてのパッケージが最新バージョンに更新されます。競合を手動でマージする必要がある場合があります。

次に、パッケージを再インストールします：

```bash
pnpm i
```

## 更新されたPromiseベースの動的API

MakerkitのNext.js 15アップデートの大部分の変更は、動的APIをPromiseベースのAPIに変更することに関連しています。

これは、クッキー、ヘッダー、クエリパラメータ、セグメントにアクセスする際に、同期関数の代わりにプロミスを使用するようにコードを更新する必要があることを意味します。

例えば、以前は次のようなコードがありました：

```javascript
const cookie = cookies().get('session');
```

現在は次のコードを使用する必要があります：

```javascript
const cookieStore = await cookies();
const cookie = cookieStore.get('session');
```

同じことがヘッダー、クエリパラメータ、セグメントにも適用されます。

## Next.js 15 Codemodの使用

Next.jsには、同期関数の代わりにプロミスを使用するようにコードベースを自動的に更新するcodemodが付属しています。次のコマンドを実行して使用できます：

```bash
npx @next/codemod@canary upgrade latest
```

このコマンドを実行する場合は、モノレポをサポートしていないため、`apps/web`ディレクトリ内で実行してください。

このコマンドは完璧ではない可能性があるため、変更を二重チェックしてください。このコマンドによって引き起こされた問題が発生した場合は、MakerkitのサポートではなくNext.jsのGithub issuesを参照してください。

## Reactコンパイラ

Reactコンパイラはデフォルトでオフに設定されています。これはまだ実験的なものであり、本番環境で有効にすることは推奨されていません。

ただし、`next.config.mjs`ファイルで`experimental.reactCompiler`フラグを`true`に設定することで有効にできます。

`.env`ファイルで環境変数`ENABLE_REACT_COMPILER`を有効にすることでこれを行うことができます：

```
ENABLE_REACT_COMPILER=true
```

## モックモジュールによるローカル開発の高速化

開発中にすべてのパッケージをコンパイルする必要がないため、モックモジュールにエイリアスを設定して、開発コンパイル（ページ遷移、ホットリロードなど）を高速化します。

これを実現するために、`next.config.mjs`ファイルでTurbopackのエイリアス機能を使用しています。

詳細はそれほどありませんが、気になる方のために、モックモジュールを読み込むコードを追加した理由はこれです。

## 依存関係の更新

すべての依存関係が最新バージョンに更新されています。これには、Radix UI、Stripeなどの注目すべき変更が含まれます。

## 詳細なTailwindCSSパス

Tailwindの生成が（何らかの理由で）かなり遅くなり、修正策として`'../../packages/**/src/**/*.tsx'`パスを詳細なパスに変換しました。

`tooling/tailwind/index.ts`

```javascript
'../../packages/ui/src/**/*.tsx',
'../../packages/billing/gateway/src/**/*.tsx',
'../../packages/features/auth/src/**/*.tsx',
'../../packages/features/notifications/src/**/*.tsx',
'../../packages/features/admin/src/**/*.tsx',
'../../packages/features/accounts/src/**/*.tsx',
'../../packages/features/team-accounts/src/**/*.tsx',
'!**/node_modules',
],
```

独自のライブラリを作成した場合は、必ずリストに追加してください。

例えば、`projects`という名前の機能を作成し、そこでTailwindを使用したい場合は、リストに次のパスを追加できます：

`tooling/tailwind/index.ts`

```javascript
'../../packages/features/projects/src/**/*.tsx',
```

## 結論

MakerkitをNext.js 15に更新するプロセスは比較的簡単です。ただし、マージの競合が発生する可能性があり、手動で解決する必要があります。

さらに、クッキー、ヘッダー、クエリパラメータ、セグメントにアクセスする際に、同期関数の代わりにプロミスを使用するようにコードを更新する必要があります。

更新プロセスについて質問がある場合や助けが必要な場合は、Discordサーバーにアクセスしてください。
