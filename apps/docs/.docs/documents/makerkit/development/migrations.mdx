---
title: '新しいマイグレーションを作成しデータベーススキーマを更新する方法'
description: 'Next.js Supabaseアプリケーションで新しいマイグレーションを作成しデータベーススキーマを更新する方法を学ぶ'
icon: 'database'
order: 2
---

# Next.js Supabaseアプリケーションで新しいマイグレーションを作成しデータベーススキーマを更新する方法

新しいアプリケーションを構築する際の主要なタスクの1つは、データのスキーマを作成することです。このガイドでは、Next.js Supabaseアプリケーションで新しいマイグレーションを作成し、データベーススキーマを更新する方法について説明します。

## マイグレーションに関する簡単な説明

Supabaseのホスト型Studioはとても優れていますが、スキーマの変更を実行するために使用すべきではないと考えています。代わりに、ローカルのSupabase Studioを使用して変更を行い、マイグレーションファイルを生成することをお勧めします。その後、マイグレーションをリモートのSupabaseインスタンスにプッシュできます。

この時点で、2つの選択肢があります：

1. `pnpm --filter web supabase migration new <name>`でマイグレーションを作成し、コードを手動で更新する
2. または、ローカルのSupabase Studioを使用して変更を行い、`pnpm --filter web supabase db diff -f <name>`を実行してマイグレーションファイルを生成する。**ファイルを必ず二重チェックしてください！**

ローカルでの変更をすべてテストして満足したら、`pnpm --filter web supabase db push`でマイグレーションをリモートのSupabaseインスタンスにプッシュします。

逆の方法も可能ですが、以下の点に注意してください：

- 本番データベースに対して変更を行うため、リスクがあります
- ローカルでの変更をテストしないため、リスクがあります
- 同期を取るために、リモートのSupabaseインスタンスからローカルインスタンスに変更をプルする必要があります

## マイグレーションの作成

アプリのスキーマを構築するための最初のステップは、新しいマイグレーションを作成することです。

そのためには、次のコマンドを実行します：

```bash
pnpm --filter web supabase migration new <name>
```

マイグレーションは`apps/web/supabase/migrations`に生成されます。

SQLコマンドを追加したら、それを有効にするためにスキーマをリセットする必要があります：

```bash
pnpm run supabase:web:reset
```

これでスキーマが設定されました！やったね！

## Supabaseタイプの生成

スキーマが設定されたので、Supabaseクライアントが正しく動作するようにタイプを生成する必要があります。

次のコマンドを実行してください：

```bash
pnpm run supabase:web:typegen
```

これで、Supabaseクライアントはスキーマの変更に合わせて正しく型を推論するようになります。
