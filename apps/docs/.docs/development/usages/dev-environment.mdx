---
title: 開発環境利用マニュアル
order: 1
---

このドキュメントでは、VSCodeのタスク機能を利用した開発環境の設定・起動方法について説明します。

## 目次

- [概要](#概要)
- [前提条件](#前提条件)
- [タスク一覧](#タスク一覧)
  - [開発環境: 起動関連](#開発環境-起動関連)
  - [開発環境: 停止関連](#開発環境-停止関連)
  - [ログ確認](#ログ確認)
  - [セットアップ & 設定](#セットアップ--設定)
  - [確認 & トラブルシューティング](#確認--トラブルシューティング)
  - [複合タスク](#複合タスク)
- [一般的な開発ワークフロー](#一般的な開発ワークフロー)
- [トラブルシューティング](#トラブルシューティング)
- [カスタマイズ方法](#カスタマイズ方法)

## 概要

このプロジェクトでは、VSCodeのタスク機能を活用して開発環境の起動・停止・管理を簡素化しています。コマンドラインで複雑なスクリプトを実行する代わりに、VSCodeの統合されたインターフェースからワンクリックで各種操作が可能です。

## 前提条件

- Visual Studio Code（最新版推奨）
- Docker Desktop
- Supabase CLI
- mkcert（HTTPS証明書生成用）

## タスクの実行方法

タスクを実行するには、以下のいずれかの方法を使用します：

1. **キーボードショートカット**：
   - `Ctrl+Shift+B`（Windows/Linux）または `Cmd+Shift+B`（macOS）を押すと、デフォルトのビルドタスク（🚀 開発環境: すべて起動）が実行されます
   - または、このショートカットでタスク選択メニューが表示されます

2. **コマンドパレット**：
   - `Ctrl+Shift+P`（Windows/Linux）または `Cmd+Shift+P`（macOS）を押し、「Tasks: Run Task」と入力して選択します
   - 表示されるリストから実行したいタスクを選びます

3. **VSCodeの「ターミナル」メニュー**：
   - メニューバーから「ターミナル」→「タスクの実行」を選択します

## タスク一覧

### 開発環境: 起動関連

| タスク名 | 説明 | コマンド |
|---------|------|---------|
| 🚀 開発環境: すべて起動 | 開発環境をすべて自動的に起動します（初回起動時に推奨） | `./scripts/dev/start-all.sh` |
| 🖥️ 開発環境: アプリのみ起動 | Supabaseが起動していることを確認し、すべてのアプリを起動します | `./scripts/dev/start-dev-apps.sh` |
| 🖥️ 開発環境: Webアプリのみ起動 | Webアプリケーションのみを起動します | `./scripts/dev/start-dev-apps.sh web` |
| 🖥️ 開発環境: Docsアプリのみ起動 | ドキュメントアプリケーションのみを起動します | `./scripts/dev/start-dev-apps.sh docs` |
| 🖥️ 開発環境: Adminアプリのみ起動 | 管理アプリケーションのみを起動します | `./scripts/dev/start-dev-apps.sh admin` |
| 💻 開発環境: アーキテクチャ最適化起動 | 実行環境のCPUアーキテクチャ(Intel/ARM)に最適化して環境を起動します | `./scripts/dev/start-for-arch.sh` |
| 📊 Supabase: 起動 | Supabaseサービスを起動します | `./scripts/dev/start-supabase.sh` |

### 開発環境: 停止関連

| タスク名 | 説明 | コマンド |
|---------|------|---------|
| 🛑 開発環境: すべて停止 | すべての開発サービスを停止します | `./scripts/dev/stop-all.sh` |
| 🧹 開発環境: すべて停止してボリューム削除 | すべての開発サービスを停止し、データボリュームも削除します（注意: データが消えます） | `./scripts/dev/stop-all.sh --remove-volumes` |

### ログ確認

| タスク名 | 説明 | コマンド |
|---------|------|---------|
| 📋 ログ: Webアプリ | Webアプリケーションのログを表示します | `./scripts/dev/logs.sh web` |
| 📋 ログ: Docsアプリ | ドキュメントアプリケーションのログを表示します | `./scripts/dev/logs.sh docs` |
| 📋 ログ: Adminアプリ | 管理アプリケーションのログを表示します | `./scripts/dev/logs.sh admin` |
| 📋 ログ: 全サービス | すべてのサービスのログを一括表示します | `./scripts/dev/logs.sh -a` |

### セットアップ & 設定

| タスク名 | 説明 | コマンド |
|---------|------|---------|
| 🔧 セットアップ: ホスト名 | ローカル開発用のホスト名を/etc/hostsに設定します | `./scripts/dev/setup-hosts.sh` |
| 🔒 セットアップ: HTTPS証明書 | ローカル開発用のHTTPS証明書を生成します | `./scripts/dev/setup-https-certs.sh` |
| 🔑 セットアップ: シークレット生成 | アプリケーション用のシークレットキーを生成します | `./scripts/dev/generate-secrets.sh` |
| 🔐 セットアップ: JWTシークレット設定 | JWT認証用のシークレットキーを設定します | `./scripts/dev/setup-jwt-secret.sh` |

### 確認 & トラブルシューティング

| タスク名 | 説明 | コマンド |
|---------|------|---------|
| 📋 確認: Supabase状態 | 既存のSupabaseプロセスを確認し、必要に応じて停止します | `./scripts/dev/check-local-supabase.sh` |
| 🔍 診断: JWT認証 | JWT認証の問題を診断します | `./scripts/dev/debug-jwt.sh` |
| 🔧 修正: PostgREST | PostgRESTサービスの問題を修正します | `./scripts/dev/fix-postgrest.sh` |

### 複合タスク

| タスク名 | 説明 | 実行するタスク |
|---------|------|--------------|
| 🔄 初期セットアップ実行 | 開発環境の初期セットアップを完了します | 1. 🔧 セットアップ: ホスト名 2. 🔒 セットアップ: HTTPS証明書 3. 🔑 セットアップ: シークレット生成 |
| 🔄 再起動 | すべての環境を停止してから再起動します | 1. 🛑 開発環境: すべて停止 2. 🚀 開発環境: すべて起動 |

## 一般的な開発ワークフロー

### 初回セットアップ（新しいマシンでの開発開始時）

1. **前提条件のインストール**確認
   ```bash
   # Docker確認
   docker --version
   # Supabase CLI確認
   supabase --version
   # mkcert確認
   mkcert --version
   ```

2. **🔄 初期セットアップ実行**タスクを実行
   - ホスト名設定
   - HTTPS証明書生成
   - シークレット生成
   が順番に実行されます

3. **🚀 開発環境: すべて起動**タスクを実行
   - 開発に必要なすべてのサービスが起動されます

### 日常の開発ワークフロー

1. **🚀 開発環境: すべて起動**タスク実行（またはCtrl+Shift+B）
   - 作業開始時に一度実行するだけです

2. **開発作業実施**
   - 必要に応じて**📋 ログ: Webアプリ**などでログを確認

3. **🛑 開発環境: すべて停止**タスク実行
   - 作業終了時に実行します

### 特定アプリのみの開発

1. **🖥️ 開発環境: Webアプリのみ起動**（または対象アプリ）
   - リソースを節約できます

2. **📋 ログ: Webアプリ**でログ監視しながら開発

## トラブルシューティング

### よくある問題と解決策

1. **ポートの競合が発生する場合**
   - **🛑 開発環境: すべて停止**を実行
   - **📋 確認: Supabase状態**を実行して既存プロセスを確認・停止

2. **JWT認証の問題が発生した場合**
   - **🔍 診断: JWT認証**を実行
   - 問題が特定されたら**🔐 セットアップ: JWTシークレット設定**を実行

3. **PostgREST接続の問題**
   - **🔧 修正: PostgREST**を実行

4. **データをリセットしたい場合**
   - **🧹 開発環境: すべて停止してボリューム削除**を実行
   - その後**🚀 開発環境: すべて起動**で新しい環境を構築

### エラーログの確認方法

各種ログタスクを使って詳細なエラー情報を確認できます：

```
📋 ログ: 全サービス
```

特定のサービスに絞った詳細ログ：

```
📋 ログ: Webアプリ
```

## カスタマイズ方法

VSCodeのタスク設定はプロジェクトルートの`.vscode/tasks.json`に定義されています。必要に応じて以下のカスタマイズが可能です：

### 新しいタスクの追加

```json
{
  "label": "🔧 カスタムタスク名",
  "detail": "このタスクの詳細説明",
  "type": "shell",
  "command": "./スクリプトへのパス.sh",
  "problemMatcher": [],
  "presentation": {
    "reveal": "always",
    "panel": "new",
    "clear": true
  }
}
```

### タスクのグループ化

複数のタスクを順番に実行する場合：

```json
{
  "label": "🔄 複合タスク名",
  "detail": "複数のタスクを順番に実行します",
  "dependsOrder": "sequence",
  "dependsOn": [
    "タスク1",
    "タスク2"
  ],
  "problemMatcher": []
}
```

### プロブレムマッチャーの設定

エラー出力を解析してVSCodeの問題パネルに表示するには：

```json
"problemMatcher": {
  "owner": "custom",
  "pattern": {
    "regexp": "^(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$",
    "file": 1,
    "line": 2,
    "column": 3,
    "severity": 4,
    "message": 5
  }
}
```

---

これで環境構築と日々の開発作業が大幅に効率化されます。問題や提案があれば開発チームに連絡してください。 