---
title: DockerネットワークのIPv4、IPv6に関するメモ
date: 2025-03-24
---

IPv4に制限することによる影響
接続性の限定
IPv6専用ネットワークやデバイスからのアクセスができなくなります
将来のIPv6完全移行時に再度変更が必要になります
技術的影響
IPv4アドレスの枯渇問題に対応できない（この場合はローカル環境なので影響なし）
一部の最新ネットワーク機能がIPv6でのみ利用可能な場合は使用できなくなる
現在の環境への影響
ローカル開発環境では実質的な影響はほぼありません
すでにNGINXがIPv4経由でリクエストを処理できていることが確認されています

DockerネットワークとIPv6の関係
Dockerは標準設定ではIPv6を無効化しています。これには複数の理由があります：
Docker Networkの標準設定
デフォルトではIPv4のみの構成になっています
IPv6サポートは明示的に有効化が必要
IPv6サポートのための設定
Docker ComposeでIPv6を有効にするには以下のような設定が必要です：

```yaml
   networks:
     default:
       enable_ipv6: true
       ipam:
         config:
           - subnet: "fd00::/80"
```

ホストマシンとの連携
IPv6が機能するにはホストマシン自体もIPv6設定が適切に構成されている必要があります
host.docker.internalはホストマシンを指すための特殊なDNS名ですが、実装上IPv4に優先的にマッピングされる場合が多いです
現在の問題の本質
エラーログで見られる問題は次のような流れで発生しています：
NGINXがリクエストを受信しています（IPv4経由）
それをhost.docker.internalに転送しようとしています
NGINXはDNS解決でhost.docker.internalをIPv6アドレス[fdc4:f303:9324::254]として解決してしまっています
しかし実際のコンテナネットワークはIPv6をサポートしていないか、適切に設定されていないため接続に失敗しています
この問題を解決する最も簡単な方法は、IPv4のみを使用するようNGINXの設定を変更することです。これはローカル開発環境では標準的な対応であり、将来的な本番環境ではIPv6も適切に構成できます。

