---
title: 'スクリプト修正と問題解決'
description: ''
date: '2025-03-26'
author: 'Akimasa Sugai'
tags: ['スクリプト', '修正', '問題解決', 'デバッグ']
---

# スクリプト修正と問題解決

### 作業ドキュメント：スクリプト修正と問題解決の記録

## 1. 問題の概要

`scripts/docs/update-all-journals.sh` スクリプトの実行時に、以下のエラーが発生していました：

```
Exit prior to config file resolving
cause
call config.load() before reading values
MDXフロントマターの更新に失敗しました
```

このエラーはファイルパスの参照が正しくなく、設定ファイルを読み込めないことが原因でした。

## 2. 問題の詳細分析

### 2.1 初期調査

- スクリプトの実行環境とディレクトリ構造を確認
- プロジェクトルートは `/Users/sugaiakimasa/apps/saedgewell`
- `.docs/journals` ディレクトリが存在することを確認
- 実行スクリプトの場所は `scripts/docs/update-all-journals.sh`

### 2.2 発見した問題点

1. **ディレクトリ移動と実行パスの不一致**：
   - スクリプトが `apps/docs` に移動後、相対パスで実行されていた
   - 実際のスクリプトファイルは `apps/docs/scripts` ディレクトリにあるが、相対パスだけで参照していた

2. **環境変数設定の問題**：
   - `PROJECT_ROOT` 環境変数がディレクトリ移動後に設定されており、プロジェクトルートを正しく参照できていなかった

3. **package.jsonの構文エラー**：
   - `apps/web/package.json` ファイルに重複した依存関係があり、JSONフォーマットが壊れていた

## 3. 実施した修正

### 3.1 スクリプト実行環境の改善

1. **ディレクトリ移動の削除**：
   - `cd ./apps/docs` コマンドを削除し、プロジェクトルートから直接スクリプトを実行するように変更

2. **絶対パスの使用**：
   - スクリプトを絶対パスで指定：`${SCRIPTS_DIR}/update-journal-entries.ts`
   - スクリプトディレクトリパスを変数として定義：`SCRIPTS_DIR="${PROJECT_ROOT}/apps/docs/scripts"`

3. **環境変数の正しい設定**：
   - `PROJECT_ROOT` 環境変数をディレクトリ移動前に設定
   - この環境変数を使って `.docs/journals` ディレクトリを正しく参照できるようにした

4. **デバッグ機能の強化**：
   - `--debug` フラグを追加して詳細情報を表示
   - パスや実行環境の確認を容易にするデバッグ情報を追加

### 3.2 package.jsonの修正

`apps/web/package.json` ファイルにあった以下の問題を修正：
- 重複した依存関係を削除
- 欠けていたカンマを追加
- 正しいJSONフォーマットに修正

## 4. 実行結果

修正後、スクリプトは以下の処理を正常に完了：

1. **MDXフロントマター処理**：
   - 13個の日付ディレクトリをスキャン
   - 2025-03-26のディレクトリのみ変更があり、2件のエントリを更新
   - 残り12個のディレクトリは変更なしとしてスキップ

2. **GitHubコミット情報の取得**：
   - 7個の日付ディレクトリを処理
   - GitHub API制限（403エラー）により一部のリポジトリ情報取得に失敗したが、スクリプト自体は正常に実行された

## 5. 今後の改善点と注意事項

- **GitHub API制限対策**：
  - GitHub Personal Access Tokenを設定することで、API制限を回避できる可能性がある

- **ディレクトリ構造の変更時の対応**：
  - ファイルの位置を変更する場合は、参照パスも適切に更新する必要がある
  - 絶対パスと環境変数を活用し、柔軟なパス参照ができるように考慮する

- **エラーハンドリングの改善**：
  - 詳細なデバッグ情報を表示できるようにし、問題発生時の原因特定を容易にしておく

これらの修正により、スクリプトは正常に動作するようになり、エラーなく完了するようになりました。
